<!-- <div id="signDiv">
	Username: <input id="signDiv-username" type="text"></input>
	<button id="signDiv-signIn">Sign In</button><br>
	Password: <input id="signDiv-password" type ="password"></input>
	<button id="signDiv-signUp">Sign Up</button>
</div> -->

<!-- <div id="gameDiv" style="display: none;">
 -->

<!DOCTYPE html>
<html>
<head>
	<title>game dev mmo</title>
	<link rel="stylesheet" type="text/css" href="/client/style.css">
</head>
	<body>
		<div id="gameDiv">
			<h1>DEV INVADERS</h1>
			<div id ="canvasContainer">
				<canvas id="ctx" width="640" height="380"></canvas>
			</div>
			<div id="chat-text"></div>
			<form id="chat-form">
				<input id="chat-input" "type=text" name="etext" placeholder="chat text"></input>
			</form>
		</div>
	</body>
</html>

<script src ="https://cdn.socket.io/socket.io-1.4.5.js"></script>
<script>

	window.addEventListener("load", gamePlay, false);

	var socket = io();
	//sign in
	// var signDiv = document.getElementById('signDiv');
	// var signDivUsername = document.getElementById('signDiv-username');
	// var signDivSignIn = document.getElementById('signDiv-signIn');
	// var signDivSignUp = document.getElementById('signDiv-signUp');
	// var signDivPassword = document.getElementById('signDiv-password');

	// signDivSignIn.onclick = function(){
	// 	socket.emit('signIn', {username:signDivUsername.value, password:signDivPassword.value})
	// }
	// socket.on('signInResponse', function(data){
	// 	if(data.success){
	// 		signDiv.style.display = 'none';
	// 		gameDiv.style.display = 'inline-block';
	// 	} else {
	// 		alert("Sign in Unsuccessful.");
	// 	}
	// });

	//TEST CODE------------------------





	//TEST CODE------------------------

	//GAME------------------------------------------------
	var chatText = document.getElementById('chat-text');
	var chatInput = document.getElementById('chat-input');
	var chatForm = document.getElementById('chat-form');
	var ctx = document.getElementById("ctx").getContext("2d");
	var canvasWidth = ctx.canvas.width;
	var canvasHeight = ctx.canvas.height;
	var backgroundImgWidth = 0;
	var backgroundImgHeight = 0;
	var playerSprite = new Image();
	var spaceBackground = new Image();
	var scrollVal = 0;
	var speed = 8;

	//ASSETS------------------------------------------------
	playerSprite.src = "/client/img/nightraiderfixed.png";
	spaceBackground.src = "/client/img/spaceBackground.png";

	//GAME--------------------------------------------------
	function gamePlay(){
		socket.on("newPosition", function(data){
			ctx.clearRect(0,0,canvasWidth,canvasHeight);
			loadBackgroundImg();
			player(data);
		});
	}

	//CHAT--------------------------------------------------
	socket.on('addToChat', function(data){
		chatText.innerHTML += '<div>' + data + '</div>';
	});
	chatForm.onsubmit = function(e){
		e.preventDefault();
		socket.emit('sendMsgToServer', chatInput.value);
		chatInput.value = '';
	}
	//chat auto scroll down
	chatText.scrollTop = chatText.scrollHeight;	
	setInterval(function(){ 
		var scrollUpdate = document.getElementById("chat-text");
		    scrollUpdate.scrollTop = chatText.scrollHeight;
	},1000);

	//CONTROLS------------------------------------------------
	document.onkeydown = function(event){
		if(event.keyCode === 68)	//d
			socket.emit('keyPress',{inputId:'right',state:true});
		else if(event.keyCode === 83)	//s
			socket.emit('keyPress',{inputId:'down',state:true});
		else if(event.keyCode === 65) //a
			socket.emit('keyPress',{inputId:'left',state:true});
		else if(event.keyCode === 87) // w
			socket.emit('keyPress',{inputId:'up',state:true});		
	}

	document.onkeyup = function(event){
		if(event.keyCode === 68)	//d
			socket.emit('keyPress',{inputId:'right',state:false});
		else if(event.keyCode === 83)	//s
			socket.emit('keyPress',{inputId:'down',state:false});
		else if(event.keyCode === 65) //a
			socket.emit('keyPress',{inputId:'left',state:false});
		else if(event.keyCode === 87) // w
			socket.emit('keyPress',{inputId:'up',state:false});
	}

	//PLAYER----------------------------------------------------
	function player(data){
		for(var i = 0; i < data.length; i++){
			ctx.drawImage(playerSprite, data[i].x, data[i].y,50,50);
			if(data[i].x+50 >= canvasWidth){
				console.log("collision right wall");
				socket.emit('keyPress',{inputId:'right',state:false});
			}
		}
	}

	//BACKGROUND------------------------------------------------
	function loadBackgroundImg(){
		backgroundImgWidth = spaceBackground.width,
		backgroundImgHeight = spaceBackground.height;
		renderBackground();                
	}

	function renderBackground(){
		if(scrollVal >= canvasWidth){
			//console.log(scrollVal);
			scrollVal = 0;
		}

		scrollVal+=speed;				
		ctx.drawImage(spaceBackground,-scrollVal,0,backgroundImgWidth, backgroundImgHeight);
     	ctx.drawImage(spaceBackground,canvasWidth-scrollVal,0,backgroundImgWidth, backgroundImgHeight);
	}

</script>	